# CLI (`@trinacria/cli`)

The CLI exposes the `trinacria` command with three main commands:

- `dev`: development mode with auto-restart
- `build`: TypeScript compilation
- `start`: production startup from compiled output

## Installation

```bash
npm i -D @trinacria/cli
```

## Usage

```bash
trinacria dev
trinacria build
trinacria start
```

Common options:

- `--config <path>` use a custom config file
- `--help` show help

## Configuration

Supported file names:

- `trinacria.config.js`
- `trinacria.config.cjs`
- `trinacria.config.mjs`

If no config file is found, defaults are applied.

### Config contract

```ts
export interface ResolvedConfig {
  entry: string;
  outDir: string;
  watchDir: string;
  env: "development" | "production" | string;
}
```

`TrinacriaConfig` is `Partial<ResolvedConfig>`.

### Defaults

```ts
{
  entry: "src/main.ts",
  outDir: "dist",
  watchDir: "src",
  env: "development"
}
```

### Example `trinacria.config.mjs`

```js
/** @type {import('@trinacria/cli').TrinacriaConfig} */
export default {
  entry: "src/main.ts",
  outDir: "dist",
  watchDir: "src",
  env: "development",
};
```

## `dev` command

```bash
trinacria dev
```

Behavior:

- runs `entry` through the local `tsx` CLI entry (`tsx/cli`)
- watches `watchDir` with `chokidar`
- restarts process on file changes
- restart debounce: `100ms`
- auto-restart when app crashes (exit code != 0)
- graceful shutdown on `SIGINT`/`SIGTERM`
- child stop timeout before `SIGKILL`: `3000ms`

## `build` command

```bash
trinacria build
```

Behavior:

- looks for `tsconfig.json` in cwd
- fails fast if `tsconfig.json` cannot be read/parsed
- creates a TypeScript program with `outDir` override from config
- compiles and prints diagnostics (error/warning with file:line:col)
- prints number of compiled files and build duration
- exits with code `1` on `emitSkipped` or errors

## `start` command

```bash
trinacria start
```

Behavior:

- resolves JS entry from `entry` using TypeScript `rootDir/outDir` mapping
- supports extension mapping (`.ts/.tsx -> .js`, `.mts -> .mjs`, `.cts -> .cjs`)
- runs using the current Node runtime (`process.execPath`)
- inherits stdio
- fails if built entry file does not exist
- fails if child process exits with code != 0

## Recommended flow

Development:

```bash
trinacria dev
```

Production build:

```bash
trinacria build
trinacria start
```

## Config resolution (`--config`)

Order:

1. If `--config` is passed, use that path.
2. Otherwise search default file names in cwd.
3. If nothing is found, use `defaultConfig`.

The CLI first tries `require()` (CJS), then falls back to `import()` for ESM files.

If `--config` is explicitly passed and the path is invalid/missing, the CLI fails fast with an error.
